generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- –ö–û–†–ò–°–¢–£–í–ê–ß–Ü –¢–ê –ü–†–û–§–Ü–õ–¨---

model User {
  id                      Int       @id @default(autoincrement())
  email                   String    @unique
  username                String
  password                String    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ö–µ—à –ø–∞—Ä–æ–ª—è
  avatarUrl               String?
  bio                     String?
  createdAt               DateTime  @default(now())

  // üîê –†–µ—Å–µ—Ç –ø–∞—Ä–æ–ª—è
  passwordResetToken      String?   @unique
  passwordResetExpiry     DateTime?

  // –ó–≤'—è–∑–∫–∏
  wallet                  Wallet?   // –û–¥–∏–Ω –≥–∞–º–∞–Ω–µ—Ü—å –Ω–∞ —é–∑–µ—Ä–∞
  stats                   UserStats? // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  
  // –£—á–∞—Å—Ç—å —É –∫–∞–º–ø–∞–Ω—ñ—è—Ö —Ç–∞ —Å–µ—Å—ñ—è—Ö
  campaignsOwned          Campaign[] @relation("OwnerCampaigns") // –ö–∞–º–ø–∞–Ω—ñ—ó, –¥–µ –≤—ñ–Ω –≤–ª–∞—Å–Ω–∏–∫
  sessionsJoined          SessionParticipant[] // –°–µ—Å—ñ—ó, –¥–µ –≤—ñ–Ω –≥—Ä–∞–≤–µ—Ü—å/–º–∞–π—Å—Ç–µ—Ä
  
  // –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è
  messages                ChatMessage[] // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç–∞—Ö
  emailVerified            Boolean   @default(false)
  refreshTokens           RefreshToken[]

  emailVerificationTokens EmailVerificationToken[]
}

model Wallet {
  id      Int     @id @default(autoincrement())
  balance Float   @default(0.0)
  userId  Int     @unique
  user    User    @relation(fields: [userId], references: [id])
  
  transactions Transaction[] // –Ü—Å—Ç–æ—Ä—ñ—è –æ–ø–ª–∞—Ç
}

model UserStats {
  id             Int @id @default(autoincrement())
  hoursPlayed    Int @default(0)
  sessionsPlayed Int @default(0)
  userId         Int @unique
  user           User @relation(fields: [userId], references: [id])
}

// --- –ö–ê–ú–ü–ê–ù–Ü–á –¢–ê –°–ï–°–Ü–á ---

model Campaign {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  ownerId     Int
  owner       User      @relation("OwnerCampaigns", fields: [ownerId], references: [id])
  
  sessions    Session[] // –ö–∞–º–ø–∞–Ω—ñ—è –º–∞—î –±–∞–≥–∞—Ç–æ —Å–µ—Å—ñ–π
}

model Session {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  date        DateTime
  status      SessionStatus @default(PLANNED) // Active, Planned, Finished
  price       Float     @default(0.0) // –¶—ñ–Ω–∞ –∑–∞ –≥—Ä—É
  maxPlayers  Int       @default(4)
  
  campaignId  Int?
  campaign    Campaign? @relation(fields: [campaignId], references: [id])
  
  participants SessionParticipant[]
  messages     ChatMessage[] // –ß–∞—Ç —Å–µ—Å—ñ—ó 
}

// –¢–∞–±–ª–∏—Ü—è –∑–≤'—è–∑–∫—É: –•—Ç–æ —î —Ö—Ç–æ –≤ —Å–µ—Å—ñ—ó 
model SessionParticipant {
  id        Int      @id @default(autoincrement())
  userId    Int
  sessionId Int
  role      GameRole @default(PLAYER) // Player, Master, Owner

  user      User    @relation(fields: [userId], references: [id])
  session   Session @relation(fields: [sessionId], references: [id])

  @@unique([userId, sessionId]) // –Æ–∑–µ—Ä –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –¥–≤—ñ—á—ñ –≤ –æ–¥–Ω—ñ–π –≥—Ä—ñ
}

model EmailVerificationToken {
  id          Int      @id @default(autoincrement())
  token       String   @unique
  userId      Int
  user        User     @relation(fields: [userId], references: [id])
  expiresAt   DateTime
  createdAt   DateTime @default(now())
}

// --- –ö–û–ú–£–ù–Ü–ö–ê–¶–Ü–Ø –¢–ê –§–Ü–ù–ê–ù–°–ò ---

model ChatMessage {
  id        Int      @id @default(autoincrement())
  text      String
  createdAt DateTime @default(now())
  
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  
  sessionId Int
  session   Session  @relation(fields: [sessionId], references: [id])
}

model Transaction {
  id        Int      @id @default(autoincrement())
  amount    Float
  type      String   // "DEPOSIT" –∞–±–æ "PAYMENT"
  date      DateTime @default(now())
  
  walletId  Int
  wallet    Wallet   @relation(fields: [walletId], references: [id])
}

// --- ENUMS (–°–ø–∏—Å–∫–∏ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤) ---

enum GameRole {
  PLAYER
  MASTER
  OWNER
}

enum SessionStatus {
  PLANNED
  ACTIVE
  FINISHED
  CANCELED
}

model RefreshToken {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  revoked    Boolean  @default(false)
  createdAt  DateTime @default(now())
  expiresAt  DateTime
}